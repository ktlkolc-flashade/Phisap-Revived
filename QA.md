Phisap 原理与常见问题解答

A:什么是指针规划算法？
B:指针规划算法是 Phisap 的核心功能模块，负责将游戏谱面转换为触控事件序列。这里的"指针"泛指所有能触发屏幕触控的物体，包括手指、触控笔、虚拟指针等。

算法的主要功能：

输入：游戏谱面数据

输出：触控事件序列

管理：为每个事件分配合适的指针ID

A:为什么需要指针规划算法？
B:系统限制
安卓设备对触控事件有严格限制：

每个触控事件必须指定唯一的指针ID

同一时刻屏幕上最多允许10个指针同时存在

游戏特性
Phigros中的特殊note类型：

Drag（黄键）：判定不关注UP/DOWN事件，只关心判定区是否存在指针

Flick（红键）：需要指针在判定区内移动

技术挑战
指针生命周期管理：不能移动不存在的指针

多note协同处理：某些谱面同时触发超过10个note

事件冲突避免：防止误触发相邻note

算法演进历程
初期方案（已弃用）
将Drag视为Tap，将Flick视为移动位置的Hold

问题：会导致相邻note误触发

当前方案
动态管理指针池

智能合并可共用的指针

优化事件触发顺序

algo1 和 algo2 的区别
algo1（算法1）和 algo2（算法2）都是指针规划算法，主要区别：

​​algo1 - 稳定性优先​​

保守的指针分配策略

适合常规谱面

处理速度较慢但稳定

​​algo2 - 性能优先​​

激进的指针复用策略

适合高密度谱面

处理速度快但可能不稳定

​​选择建议：​​

常规谱面：优先使用algo1

高密度谱面：尝试algo2

特殊谱面：两个都试，选AP率高的

注：未来版本可能会重构算法系统，algo1/algo2的命名可能会改变。

技术实现细节
指针复用策略
新note到达判定区

检查是否有空闲指针

如有则分配，否则检查可复用指针

如无可复用指针，等待或丢弃低优先级note

事件序列示例
Tap事件：DOWN → UP（间隔50ms）

Drag事件：MOVE → MOVE（位置变化）

性能优化技术
指针池预分配

事件批处理

优先级队列管理

空间局部性优化

未来发展方向
机器学习辅助决策

自适应算法选择

实时性能监控调整

多设备协同处理